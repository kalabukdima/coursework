Итак, самым подходящим подходом к решению задачи сегментации является
использование нейронных сетей. Их особенностью является то, что для достижения
хорошего результата им требуется большой объём данных для обучения. Сейчас в
свободном доступе есть большое число поставщиков космических изображений всей
поверхности земли.  Например, Yandex, Google, Bing, ESRI Imagery, и т. д.
Поэтому получение неразмеченных данных не является проблемой. Для обучения
алгоритмов классификации и сегментации необходима ``разметка'' данных, т. е.
информация о классах, которые алгоритм должен научиться распознавать. Для
дальнейшей работы требовалось выполнить разметку имеющихся данных. Для каждого
региона, из которого получены изображения составлялся файл ``маски'' этого
региона, состоящий из одноцветных областей, цвет которых обозначает какой-то
класс. Выполнение этого вручную требует значительных затрат человеческих сил и
времени. Поэтому было решено попробовать использовать размеченные данные, уже
существующие в открытом доступе.


\addcontentsline{toc}{section}{Использование данных OpenStreetMap}
\section*{Использование данных OpenStreetMap}
OpenStreetMap (OSM) – проект по созданию подробной свободной и бесплатной
географической карты мира. Карты OSM уже содержат в себе подробную информацию о
многих регионах земной поверхности. Информация добавляется и редактируется
добровольцами во всех странах мира. Вся информация в OSM хранится в векторном
виде.  Данные делятся на несколько типов:
\begin{enumerate}
    \item \textit{Точки} (\textit{Nodes})
    \item \textit{Линии} (\textit{Ways})
    \item \textit{Замкнутые линии} (\textit{Closed ways})
    \item \textit{Заполненные области} (\textit{Areas})
    \item \textit{Отношения} (\textit{Relations})
\end{enumerate}
С сайта OSM можно скачать данные в векторном виде. В них будут содержаться
данные указанных типов, с пометками о типе региона, из которых можно определить,
является ли участок полем/застройкой/водным ресурсом и т. д.
Чтобы получить данные в формате, требуемом для обучения описанных ранее
алгоритмов, нужно было их растеризовать. Для этих целей использовалась утилита
\textit{gdal\_rasterize}.
Использование готовой разметки из такого источника как OpenStreetMap значительно
упрощает работу по подготовке данных для обучения.

Далее, чтобы не отвлекаться на пролемы связанные с алгоритмами многоклассовой
сегментации, было решено рассматривать бинарную классификацию для исследования
применимости данных OSM для разметки изображений. В качестве классов были взяты
постройки и фон, т.е. всё, что не является постройками. Такое решение было
сделано в том числе потому что постройки размечаются в OSM чаще и более
качественно, чем, например, поля. Вероятно, так происходит потому что большую
часть аудитории OSM интересуют именно карты городов и поселений.
Было создано более $20$-ти размеченных изображений с размерами от $3000$ до
$8000$ пикселей. После проведения сегментации этих изображений, была достигнута
примерно такая же точность, что и при многоклассовой сегментации. Значение IoU
варьировалось от $0.3$ до $0.5$.
Но при просмотре результатов оказалось, что сеть недостаточно чётко распознавала
границы зданий. Выяснилось, что данных OSM разметка зачастую сдвинута достаточно
сильно, чтобы не проходить по границе здания. Причём разметка разных зданий
сдвинута в разные стороны, т.е. природа этой погрешности является случайной.
Для количественного измерения этой погрешности для одного из изображений была
проведена аккуратная ручная разметка. Значение IoU между OSM и ручной разметкой
составило $0.631$, что меньше, чем хотелось бы ожидать от алгоритма сегментации.

Таким образом, было решено, что данные OSM в чистом виде не подходят для
использования в качестве сегментационной маски. Но были получены и полезные
результаты. Даже при обучении не сдвинутых масках, алгоритм научился
детектировать здания достаточно хорошо, чтобы находить не изображениях те здания,
которые не были размечены в данных OSM. При правильном использовании это может
принести практическую пользу.


\addcontentsline{toc}{section}{Проблема вариативности данных}
\section*{Проблема вариативности данных}
Как уже было отмечено, данные различных поставщиков отличаются довольно сильно.
Засчёт этого, при обучении алгоритма на данных одного поставщика и попытке
сделать предсказание на данных другого поставщика (возможно, даже той же
местности) результаты получаются неудовлетворительными, намного хуже, чем при
обучении и тестировании на данных одного поставщика. Такой эффект называется
\textit{переобучением}. Аугментация --- один из подходов, признанных частично
избавиться от такого неблагоприятного эффекта. Но она не является решением всех
проблем.

Одно из заметных отличий данных разных поставщиков --- различные цветовые
палитры изображений. Существует подход, позволяющий привести цвета на
изображении к некоторой канонической палитре с целью сблизить цветовую разницу
даже тех изображений, у которых палитры сильно отличаются. Идея заключаетяс в
том чтобы нормализовать цвета в окрестности каждой точки. Т.е. из яркости
каждого канала каждой точки вычитается средняя яркость этого канала у всех точек
в окрестности некоторого фиксированного радиуса, и полученное значение делится
на корень из дисперсии яркостей этого канала у пикселей в той же окрестности.
После такого преобразования все изображения состоят из цветов близких к серому,
но границы сохраняются, и объекты на изображении всё ещё отличимы. Такой подход
давал некоторый прирост качества алгоритма, но он практически не совместим с
аугментацией, которая давала больший прирост качества.

Существуют принципиально другие, более мощные алгоритмы, позволяющие перейти от,
так называемого, \textit{домена} одного изображения к домену другого. Сами эти
алгоритмы основываются на нейронных сетях и используют в своей основе Generative
Adversarial Networks. Если научиться переводить изображения любого поставщика в
домен изображений поставщика, на которых производилось обучение, то качество
должно быть таким же хорошим как при тестировании алгоритма на тех изображениях,
на которых он обучался. Идея в том, что для тренировки алгоритма доменной
адаптации не нужны размеченные изображения, а достаточно любых изображений обоих
поставщиков. В рамках данной работы не проводились исследования в этом
направлении.
